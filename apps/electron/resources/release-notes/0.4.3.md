# v0.4.3 ‚Äî Hooks System, LLM Tool, and Stability Fixes

Introduces a comprehensive hooks system for automating workflows on app and agent events, a new `call_llm` tool for secondary AI calls, and important stability fixes.

---

## ü™ù Hooks System

- New event-driven hooks architecture for running commands and injecting prompts on app/agent events
- Event bus with support for session lifecycle, permission changes, label updates, and scheduler ticks
- Command hooks execute shell commands with permission-based security and sandboxing
- Prompt hooks inject context into agent conversations when events fire
- Cron-based scheduling via the new SchedulerService
- Event rate limiter and SIGKILL fallback for runaway hook processes
- Session metadata exposed as environment variables for hook scripts
- Source auto-activation when referenced in prompt hooks
- Event logger for debugging hook execution

## üß† LLM Tool (`call_llm`)

- New session-scoped tool enabling secondary Claude calls for specialized subtasks
- Supports summarization, classification, extraction, and analysis workflows
- Attachment-based file and image loading with line range support
- Predefined output formats plus custom JSON Schema support
- Extended thinking mode for complex reasoning tasks
- Parallel execution support for multiple simultaneous calls

## üîå Codex Improvements

- Simplified Codex connection setup by removing third-party provider options
- Bumped Codex version to craft-v0.4.1

## üêõ Bug Fixes

- Fixed Cmd+Enter sending message twice when Enter is configured as the send key (Fixes [#212](https://github.com/lukilabs/craft-agents-oss/issues/212), [#197](https://github.com/lukilabs/craft-agents-oss/issues/197))
- Fixed settings navigation ‚Äî clicking "App" no longer fails after selecting another page
- Fixed `update_user_preferences` replacing notes instead of appending
- Fixed prompt hooks not firing and source auto-activation

## üèóÔ∏è Build & Infrastructure

- Use bun-linux-x64-baseline in CI for non-AVX2 CPU compatibility (Fixes [#218](https://github.com/lukilabs/craft-agents-oss/issues/218))
- Refactored hooks: removed legacy API and global state, added comprehensive test coverage
- Improved config watcher and source config validation

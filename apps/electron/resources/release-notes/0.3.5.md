# v0.3.5 ‚Äî Claude Opus 4.6 & Auto-Update Reliability

Claude Opus 4.6 model support, reliable macOS auto-update progress, automatic image resizing, and skill mention improvements.

---

## üß† Claude Opus 4.6 Support

Craft Agent now supports **Claude Opus 4.6** (`claude-opus-4-6`) ‚Äî Anthropic's latest and most capable model.

### What Changed

- **New top-tier model** ‚Äî Opus 4.6 is OUT and now available in Craft Agents too!
- **Available everywhere** ‚Äî Settings page, chat model selector, playground, and the `call_llm` tool
- **Opus 4.5 still available** ‚Äî Listed as "Previous generation" for users who prefer it

---

## üîÑ Reliable macOS Auto-Update

Upgraded electron-updater to v6.8.0+ which fixes download-progress event emission on macOS.

### What Changed

- **Real download percentage** ‚Äî macOS now shows actual download progress instead of an indeterminate spinner
- **~150 lines of workarounds removed** ‚Äî The macOS file watcher fallback is no longer needed
- **Reliable update-downloaded event** ‚Äî Updates complete reliably without getting stuck

---

## üñºÔ∏è Automatic Image Resizing

Large images are now automatically resized instead of being rejected with an error.

### What Changed

- Images exceeding the 8000px dimension limit are **automatically resized** to fit within API limits
- Typed error codes (`ImageValidationError`) for better programmatic handling
- Clearer error messages when resize isn't possible

---

## üõ†Ô∏è Skill Mentions Improvements

- **Dot support in workspace IDs** ‚Äî Skill mentions now support dots (`.`) in workspace IDs, in addition to spaces, hyphens, and underscores
- **Space support in workspace slugs** ‚Äî Regex patterns updated for Windows path compatibility
- **28 new unit tests** covering skill pattern parsing with various workspace ID formats

---

## Improvements

### SDK Update
- Updated Claude Agent SDK from 0.2.19 to 0.2.34 (CLI 2.1.31 ‚Üí 2.1.34)
- New "Executing actions with care" system prompt section
- Enhanced Git Safety Protocol instructions

### Developer Experience
- Added Husky pre-commit hook running typecheck before commits
- Fixed TypeScript errors across shared and core packages for clean builds
- Added extracted Claude Code system prompts for SDK version tracking

### UI
- Fixed status icon colors in right-click context menu

### Documentation
- Added troubleshooting section to Gmail source guide (API enablement, OAuth credentials)

---

## Bug Fixes

- **Auto-Update**: macOS download progress now works reliably (upgraded electron-updater)
- **Images**: Large images auto-resize instead of throwing errors
- **Skill Mentions**: Fixed regex to use space instead of `\s` (prevents newline matching)
- **Context Menu**: Status icon SVG colors now render correctly
- **TypeScript**: Fixed duplicate exports, missing error codes, and type mismatches

---

## GitHub Issues

| Issue | Title | Status |
|-------|-------|--------|
| [#73](https://github.com/lukilabs/craft-agents-oss/issues/73) | Auto-update | Partially addressed |
| [#127](https://github.com/lukilabs/craft-agents-oss/issues/127) | Google OAuth tokens not injected | Partially addressed (docs) |

---

## Stats

- **40 files changed**

---

**Full Changelog**: [v0.3.4...v0.3.5](https://github.com/lukilabs/craft-agents/compare/v0.3.4...v0.3.5)

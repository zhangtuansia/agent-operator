@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* Tell Tailwind where to scan for utility classes */
@source "../**/*.{tsx,ts,jsx,js}";
@source "../../../../packages/ui/src/**/*.{tsx,ts,jsx,js}";

/* =============================================================================
   ANIMATABLE CSS CUSTOM PROPERTIES

   Register theme color variables as animatable using @property.
   This enables smooth transitions when themes change (e.g., hover preview).
   Chromium/Electron has full support for @property.
============================================================================= */

@property --background {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.98 0.003 265);
}

@property --foreground {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.185 0.01 270);
}

@property --accent {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.62 0.13 293);
}

@property --info {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.65 0.16 70);
}

@property --success {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.55 0.17 145);
}

@property --destructive {
  syntax: "<color>";
  inherits: true;
  initial-value: oklch(0.55 0.22 27);
}

/* =============================================================================
   CRAFT AGENT THEME - 6 Color System

   Base colors:
   - background: Light/dark surface
   - foreground: Text and icons
   - accent: Brand purple (highlights, Auto mode)
   - info: Amber (warnings, Ask mode)
   - success: Green (connected, checkmarks)
   - destructive: Red (errors, failed)

   Variants:
   - /50 = 50% alpha (transparency) - for borders, hovers, overlays
   - -50 = 50% mix toward background (solid) - for Explore mode

   Example: bg-foreground/10, text-accent, bg-foreground-60
============================================================================= */

/* Light Mode */
:root {
  /* === 6 BASE COLORS === */
  --background: oklch(0.98 0.003 265);
  --foreground: oklch(0.185 0.01 270);
  --foreground-rgb: 38, 36, 42;             /* RGB for shadow borders */
  --accent: oklch(0.62 0.13 293);           /* purple - brand, Auto mode */
  --accent-rgb: 104, 78, 133;               /* darkened RGB for shadow-tinted (70% of accent) */
  --info: oklch(0.75 0.16 70);              /* amber - warnings, Ask mode */
  --info-rgb: 180, 120, 40;                 /* RGB for shadow-tinted */
  --success: oklch(0.55 0.17 145);          /* green - connected, checkmarks */
  --success-rgb: 34, 120, 60;               /* RGB for shadow-tinted */
  --destructive: oklch(0.58 0.24 28);       /* red - errors, failed */
  --destructive-rgb: 180, 60, 50;           /* RGB for shadow-tinted */

  /* === SHADOW OPACITY (light mode = subtle, dark mode = stronger) === */
  --shadow-border-opacity: 0.08;            /* Border ring opacity */
  --shadow-blur-opacity: 0.06;              /* Blur/spread shadow opacity */

  /* === SHADOW VALUES (reusable across utility classes and component overrides) === */
  --shadow-minimal:
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
    rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 1px 1px -0.5px,
    rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 3px 3px -1.5px;

  --shadow-modal-small:
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
    rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 1px 1px -0.5px,
    rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 3px 3px 0px,
    rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 6px 6px 0px,
    rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 12px 12px 0px,
    rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 24px 24px 0px;

  /* === MIX VARIANTS (solid interpolation toward background) === */
  /* Use -2, -3, -5, -10, -20, ..., -90, -95 for solid colors (e.g., separators, Explore mode) */
  --foreground-1\.5: color-mix(in srgb, var(--foreground) 1.5%, var(--background));
  --foreground-2: color-mix(in srgb, var(--foreground) 2%, var(--background));
  --foreground-3: color-mix(in srgb, var(--foreground) 3%, var(--background));
  --foreground-5: color-mix(in srgb, var(--foreground) 5%, var(--background));
  --foreground-10: color-mix(in srgb, var(--foreground) 10%, var(--background));
  --foreground-20: color-mix(in srgb, var(--foreground) 20%, var(--background));
  --foreground-30: color-mix(in srgb, var(--foreground) 30%, var(--background));
  --foreground-40: color-mix(in srgb, var(--foreground) 40%, var(--background));
  --foreground-50: color-mix(in srgb, var(--foreground) 50%, var(--background));
  --foreground-60: color-mix(in srgb, var(--foreground) 60%, var(--background));
  --foreground-70: color-mix(in srgb, var(--foreground) 70%, var(--background));
  --foreground-80: color-mix(in srgb, var(--foreground) 80%, var(--background));
  --foreground-90: color-mix(in srgb, var(--foreground) 90%, var(--background));
  --foreground-95: color-mix(in srgb, var(--foreground) 95%, var(--background));

  /* Success/destructive/info interpolated toward foreground (for tinted text) */
  /* Using oklab for perceptually uniform mixing without hue shifts */
  --success-text: color-mix(in oklab, var(--success) 50%, var(--foreground));
  --destructive-text: color-mix(in oklab, var(--destructive) 50%, var(--foreground));
  --info-text: color-mix(in oklab, var(--info) 50%, var(--foreground));

  /* === SHADCN COMPATIBILITY (derived from 6 base colors) === */
  /* These variables exist for shadcn/ui component updates */
  --secondary: oklch(from var(--foreground) l c h / 0.05);
  --secondary-foreground: var(--foreground);
  --muted: oklch(from var(--foreground) l c h / 0.05);
  --muted-foreground: var(--foreground-50);
  --card: var(--background);
  --card-foreground: var(--foreground);
  --popover: var(--background);
  --popover-foreground: var(--foreground);
  --border: oklch(from var(--foreground) l c h / 0.05);
  --input: oklch(from var(--foreground) l c h / 0.1);
  --ring: oklch(from var(--foreground) l c h / 0.25);
  --ring-width: 1px;
  --ring-offset: 0px;

  /* Markdown list markers */
  --md-bullets: var(--foreground-50);
  --md-counters: var(--foreground-50);

  /* Onboarding step styling */
  --step-icon-size: 4rem;
  --step-icon-inner-size: 2rem;
  --step-icon-radius: 1rem;
  --step-title-size: 1.5rem;
  --step-description-max-width: 24rem;
  --step-actions-gap: 0.75rem;
  --step-content-gap: 1.5rem;
  --step-actions-margin: 2rem;

  /* Fonts - System fonts as default, Inter via data-font="inter" */
  --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --font-serif: "JetBrains Mono", ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
  --font-mono: "JetBrains Mono", ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace;
  --font-default: var(--font-sans);

  /* Layout */
  --font-size-base: 15px;
  --radius: 0rem;
  --spacing: 0.25rem;
  --tracking-normal: 0em;

  /* === Z-INDEX SCALE ===
     Centralized z-index registry for consistent stacking order.
     Use semantic names (z-panel, z-modal) instead of magic numbers.

     Layer              Value   Use Case
     ─────────────────────────────────────────────────────
     base               0       Default content
     local              10      Local stacking (sticky headers, icons)
     sticky             20      Sticky section headers
     titlebar           40      Window titlebar drag region
     panel              50      App panels (sidebar, chat, detail)
     dropdown           100     Dropdowns, popovers, select menus
     tooltip            150     Tooltips (above dropdowns)
     modal              200     Dialogs, drawers
     overlay            300     Full-screen overlays (settings, app chrome)
     fullscreen         350     Fullscreen content viewers (above app chrome)
     floating-backdrop  390     Backdrop for floating menus
     floating-menu      400     Floating menus above modals
     splash             600     Splash screen, workspace creation
  */
  --z-base: 0;
  --z-local: 10;
  --z-sticky: 20;
  --z-titlebar: 40;
  --z-panel: 50;
  --z-dropdown: 100;
  --z-tooltip: 150;
  --z-modal: 200;
  --z-overlay: 300;
  --z-fullscreen: 350;
  --z-floating-backdrop: 390;
  --z-floating-menu: 400;
  --z-splash: 600;

}

/* Dark Mode */
.dark {
  /* === 6 BASE COLORS === */
  --background: oklch(0.2 0.005 270);
  --foreground: oklch(0.92 0.005 270);
  --foreground-rgb: 227, 226, 229;           /* RGB for shadow borders */
  --accent: oklch(0.68 0.13 293);            /* brighter purple in dark */
  --accent-rgb: 118, 92, 147;                /* darkened RGB for shadow-tinted (70% of accent) */
  --info: oklch(0.70 0.16 70);               /* amber */
  --info-rgb: 200, 140, 60;                  /* RGB for shadow-tinted */
  --success: oklch(0.60 0.17 145);           /* green */
  --success-rgb: 50, 140, 80;                /* RGB for shadow-tinted */
  --destructive: oklch(0.70 0.19 22);        /* brighter red in dark */
  --destructive-rgb: 200, 80, 70;            /* RGB for shadow-tinted */


  /* === MIX VARIANTS === */
  --foreground-1\.5: color-mix(in srgb, var(--foreground) 1.5%, var(--background));
  --foreground-2: color-mix(in srgb, var(--foreground) 2%, var(--background));
  --foreground-3: color-mix(in srgb, var(--foreground) 3%, var(--background));
  --foreground-5: color-mix(in srgb, var(--foreground) 5%, var(--background));
  --foreground-10: color-mix(in srgb, var(--foreground) 10%, var(--background));
  --foreground-20: color-mix(in srgb, var(--foreground) 20%, var(--background));
  --foreground-30: color-mix(in srgb, var(--foreground) 30%, var(--background));
  --foreground-40: color-mix(in srgb, var(--foreground) 40%, var(--background));
  --foreground-50: color-mix(in srgb, var(--foreground) 50%, var(--background));
  --foreground-60: color-mix(in srgb, var(--foreground) 60%, var(--background));
  --foreground-70: color-mix(in srgb, var(--foreground) 70%, var(--background));
  --foreground-80: color-mix(in srgb, var(--foreground) 80%, var(--background));
  --foreground-90: color-mix(in srgb, var(--foreground) 90%, var(--background));
  --foreground-95: color-mix(in srgb, var(--foreground) 95%, var(--background));

  /* Success/destructive/info interpolated toward foreground (for tinted text) */
  /* Using oklab for perceptually uniform mixing without hue shifts */
  --success-text: color-mix(in oklab, var(--success) 50%, var(--foreground));
  --destructive-text: color-mix(in oklab, var(--destructive) 50%, var(--foreground));
  --info-text: color-mix(in oklab, var(--info) 50%, var(--foreground));

  /* === SHADCN COMPATIBILITY (derived from 6 base colors) === */
  --secondary: oklch(from var(--foreground) l c h / 0.05);
  --secondary-foreground: var(--foreground);
  --muted: oklch(from var(--foreground) l c h / 0.05);
  --muted-foreground: var(--foreground-50);
  --card: var(--background);
  --card-foreground: var(--foreground);
  --popover: var(--background);
  --popover-foreground: var(--foreground);
  --border: oklch(from var(--foreground) l c h / 0.05);
  --input: oklch(from var(--foreground) l c h / 0.1);
  --ring: oklch(from var(--foreground) l c h / 0.25);

  /* Markdown list markers */
  --md-bullets: var(--foreground-50);
  --md-counters: var(--foreground-50);
}

/* Theme Override - Semi-transparent background to allow vibrancy through */
html[data-theme-override]::before {
  content: '';
  position: fixed;
  inset: 0;
  background: color-mix(in srgb, var(--background) 50%, transparent);
  z-index: -1;
  pointer-events: none;
}

/* Theme Mismatch - Solid background when theme doesn't support current mode
   e.g. dark-only theme in light mode. Uses foreground-10 for subtle contrast. */
html[data-theme-mismatch]::before {
  content: '';
  position: fixed;
  inset: 0;
  background: var(--foreground-10);
  z-index: -1;
  pointer-events: none;
}

/* =============================================================================
   SCENIC THEME MODE

   Full-window background images with glassmorphism UI panels.
   - Background image covers entire window (fixed, centered, cover)
   - In dark mode, a semi-transparent overlay darkens the image
   - Panels use backdrop-blur for glass effect

   Activated when theme has mode='scenic' and backgroundImage set.
   Sets data-scenic="true" on <html> element.
============================================================================= */

/* Scenic mode: Background image layer */
html[data-scenic]::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: var(--background-image);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: -2;
  pointer-events: none;
}

/* Scenic mode dark: Dark overlay gradient to fade the background image
   Stronger on left (sidebar area) for readability, lighter on right to show more image */
html.dark[data-scenic]::after {
  content: '';
  position: fixed;
  inset: 0;
  background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4));
  z-index: -1;
  pointer-events: none;
}

/* Override the theme-override background for scenic mode
   We don't want the semi-transparent background layer on top of the image */
html[data-scenic][data-theme-override]::before {
  background: transparent;
  background-image: var(--background-image);
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
}

/* Scenic mode: Make background color semi-transparent for glass effect
   Panels with bg-background will become translucent glass */
html[data-scenic] {
  --background: oklch(0.2 0.005 270 / 0.55);
}

/* Inter Font - Opt-in via data-font="inter" attribute
   Loaded from Google Fonts in index.html with optical sizing (opsz) axis */
html[data-font="inter"] {
  --font-sans: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-default: var(--font-sans);
  font-optical-sizing: auto;
  font-feature-settings: "cv01", "cv02", "cv03", "cv04", "case";
}

/* Theme integration for Tailwind v4 */
@theme inline {
  /* === 6 BASE COLORS === */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-accent: var(--accent);
  --color-info: var(--info);
  --color-success: var(--success);
  --color-destructive: var(--destructive);

  /* === MIX VARIANTS (solid interpolation) === */
  --color-foreground-1\.5: var(--foreground-1\.5);
  --color-foreground-2: var(--foreground-2);
  --color-foreground-3: var(--foreground-3);
  --color-foreground-5: var(--foreground-5);
  --color-foreground-10: var(--foreground-10);
  --color-foreground-20: var(--foreground-20);
  --color-foreground-30: var(--foreground-30);
  --color-foreground-40: var(--foreground-40);
  --color-foreground-50: var(--foreground-50);
  --color-foreground-60: var(--foreground-60);
  --color-foreground-70: var(--foreground-70);
  --color-foreground-80: var(--foreground-80);
  --color-foreground-90: var(--foreground-90);
  --color-foreground-95: var(--foreground-95);

  /* === LEGACY COMPATIBILITY === */
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-destructive-foreground: var(--background);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-md-bullets: var(--md-bullets);
  --color-md-counters: var(--md-counters);

  --font-sans: var(--font-sans);
  --font-mono: var(--font-mono);
  --font-serif: var(--font-serif);

  /* === Z-INDEX SCALE === */
  --z-index-base: var(--z-base);
  --z-index-local: var(--z-local);
  --z-index-sticky: var(--z-sticky);
  --z-index-titlebar: var(--z-titlebar);
  --z-index-panel: var(--z-panel);
  --z-index-dropdown: var(--z-dropdown);
  --z-index-tooltip: var(--z-tooltip);
  --z-index-modal: var(--z-modal);
  --z-index-overlay: var(--z-overlay);
  --z-index-fullscreen: var(--z-fullscreen);
  --z-index-floating-backdrop: var(--z-floating-backdrop);
  --z-index-floating-menu: var(--z-floating-menu);
  --z-index-splash: var(--z-splash);

  --shadow-2xs: var(--shadow-2xs);
  --shadow-xs: var(--shadow-xs);
  --shadow-sm: var(--shadow-sm);
  --shadow: var(--shadow);
  --shadow-md: var(--shadow-md);
  --shadow-lg: var(--shadow-lg);
  --shadow-xl: var(--shadow-xl);
  --shadow-2xl: var(--shadow-2xl);
}

/* Global styles - MUST be in @layer base so utilities can override */
@layer base {
  * {
    box-sizing: border-box;
    border-color: var(--border);
  }

  html {
    font-size: var(--font-size-base);
  }

  html, body, #root {
    height: 100%;
    overflow: hidden;
  }

  body {
    font-family: var(--font-default);
    background: transparent;
    color: var(--foreground);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--muted-foreground);
  }

  /* Focus ring styles - override Tailwind ring utilities */
  *:focus-visible {
    outline: none;
    --tw-ring-offset-width: var(--ring-offset);
    --tw-ring-width: var(--ring-width);
    --tw-ring-color: var(--ring);
  }
}

/* Override Tailwind ring width utilities to use theme variable */
@layer utilities {
  .ring-1, .ring-2, .ring-\[3px\], .ring-4 {
    --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
    --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(var(--ring-width) + var(--tw-ring-offset-width)) var(--tw-ring-color);
    box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
  }

  /* Hide scrollbar but keep scrolling */
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }

  /* Mask fade utilities - for fading content at edges over transparent/image backgrounds */
  .mask-fade-y {
    mask-image: linear-gradient(to bottom, transparent 0%, black 32px, black calc(100% - 32px), transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 32px, black calc(100% - 32px), transparent 100%);
  }

  /* Custom shadow utilities
     - Border layer (1px ring) uses foreground color with --shadow-border-opacity
     - Blur/spread layers use black with --shadow-blur-opacity
     - Dark mode has stronger values for visibility */
  .shadow-thin {
    box-shadow:
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px;
  }

  .shadow-minimal {
    box-shadow: var(--shadow-minimal);
  }

  .shadow-middle {
    box-shadow:
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 1px 1px -0.5px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 3px 3px -1.5px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 6px 6px -3px;
  }

  /* Tinted shadow using CSS variable - use with style={{ '--shadow-color': 'r, g, b' }} */
  .shadow-tinted {
    --shadow-color: 0, 0, 0;
    box-shadow:
      rgba(var(--shadow-color), 0) 0px 0px 0px 0px,
      rgba(var(--shadow-color), 0) 0px 0px 0px 0px,
      rgba(var(--shadow-color), calc(var(--shadow-border-opacity) * 1.5)) 0px 0px 0px 1px,
      rgba(var(--shadow-color), var(--shadow-border-opacity)) 0px 1px 1px -0.5px,
      rgba(var(--shadow-color), var(--shadow-blur-opacity)) 0px 3px 3px -1.5px,
      rgba(var(--shadow-color), calc(var(--shadow-blur-opacity) * 0.67)) 0px 6px 6px -3px;
  }

  .shadow-strong {
    box-shadow:
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 1px 1px -0.5px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 3px 3px -1.5px,
      rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 6px 6px -3px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 12px 12px -6px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 24px 24px -12px;
  }

  .shadow-modal-small {
    box-shadow: var(--shadow-modal-small);
  }

  /* =============================================================================
     UNIFIED POPOVER STYLING

     Use this class for all dropdowns, popovers, dialogs, and floating menus
     to ensure consistent appearance across the app. Matches the vibrancy style:
     - Semi-transparent dark background with blur
     - 8px corner radius
     - Layered shadow (shadow-modal-small)
     - No visible border
  ============================================================================= */
  .popover-styled {
    background: var(--background);
    color: var(--foreground);
    border-radius: 8px;
    border: none;
    box-shadow:
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(0, 0, 0, 0) 0px 0px 0px 0px,
      rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 1px 1px -0.5px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.67)) 0px 3px 3px 0px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 6px 6px 0px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 12px 12px 0px,
      rgba(0, 0, 0, calc(var(--shadow-blur-opacity) * 0.33)) 0px 24px 24px 0px;
  }
}

/* Draggable title bar region for transparent window */
.titlebar-drag-region {
  -webkit-app-region: drag;
  app-region: drag;
}

.titlebar-no-drag {
  -webkit-app-region: no-drag;
  app-region: no-drag;
}

/* =============================================================================
   SCENIC MODE - GLASS PANEL EFFECTS

   In scenic mode, panels become translucent with backdrop blur (glassmorphism).
   The glass effect provides visual depth while showing the background image through.
   Target panels by their shadow classes (shadow-middle, shadow-strong).
============================================================================= */

  html[data-scenic] .shadow-middle,
  html[data-scenic] .shadow-strong {
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  position: relative;
  /* Ensure panels are above the titlebar drag region (z-titlebar: 40) so header buttons are clickable.
     Without this, the position:relative creates a stacking context at z-index:auto which is below the fixed titlebar. */
  z-index: var(--z-panel);
}

/* Scenic mode: Input field gets more transparency to show background through
   Uses a much lighter overlay to let the blurred background image show through */
html[data-scenic] .input-container {
  background: rgba(0, 0, 0, 0.15);
}

/* Scenic mode: Gradient border effect for glass panels
   Uses a pseudo-element with a white linear gradient (40% at top, 5% at bottom).
   The mask-composite technique creates a border-only effect from a filled gradient. */
html[data-scenic] .shadow-middle::before,
html[data-scenic] .shadow-strong::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 1px;
  background: linear-gradient(
    to bottom,
    rgba(255, 255, 255, 0.3),
    rgba(255, 255, 255, 0.1)
  );
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  pointer-events: none;
  z-index: 1;
  mix-blend-mode: soft-light;
}

/* Scenic mode: Ensure panel content is above the gradient border pseudo-element.
   Without this, interactive elements (buttons, dropdowns) in the header area
   can be visually obscured or have click issues due to stacking context with backdrop-filter.
   Creates explicit stacking for direct children so they sit above ::before (z-index: 1). */
html[data-scenic] .shadow-middle > *,
html[data-scenic] .shadow-strong > * {
  position: relative;
  z-index: 2;
}


/* Scenic mode: Popovers get glass effect too */
html[data-scenic] .popover-styled {
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
}

/* Scenic mode: Fullscreen overlay background gets glass effect
   Applied to the AI response fullscreen view background so it blends
   with the scenic background image when viewing expanded content. */
html[data-scenic] .fullscreen-overlay-background {
  backdrop-filter: blur(24px);
  -webkit-backdrop-filter: blur(24px);
}

html[data-scenic]:not(.dark) .fullscreen-overlay-background {
  background: color-mix(in srgb, var(--foreground-3) 70%, transparent);
}

html.dark[data-scenic] .fullscreen-overlay-background {
  background: color-mix(in srgb, var(--foreground-3) 60%, transparent);
}

/* =============================================================================
   DISABLE ANIMATIONS FOR DIALOGS, DROPDOWNS, AND POPOVERS

   Radix UI (used by shadcn/ui) applies animations via data-state attributes.
   This globally disables enter/exit animations for overlay components.

   To re-enable for specific components, use: animation: revert !important;
============================================================================= */

/* Dialog overlay (backdrop) */
[data-radix-dialog-overlay] {
  animation: none !important;
}

/* Dialog content */
[role="dialog"][data-state],
[data-radix-dialog-content] {
  animation: none !important;
}

/* Dropdown menu content */
[data-radix-menu-content],
[data-radix-dropdown-menu-content] {
  animation: none !important;
}

/* Popover content */
[data-radix-popover-content] {
  animation: none !important;
}

/* Select content */
[data-radix-select-content] {
  animation: none !important;
}

/* Tooltip content (if you want tooltips instant too) */
[data-radix-tooltip-content] {
  animation: none !important;
}

/* Context menu content */
[data-radix-context-menu-content] {
  animation: none !important;
}

/* Alert dialog */
[data-radix-alert-dialog-overlay],
[data-radix-alert-dialog-content] {
  animation: none !important;
}

/* Fix ScrollArea internal div preventing content shrink
   Radix injects a div with min-width: 100%; display: table; which prevents shrinking */
[data-radix-scroll-area-viewport] > div {
  min-width: 0 !important;
  display: block !important;
}

/* =============================================================================
   ONBOARDING STEP STYLES

   Global styles for onboarding components using CSS custom properties.
   Change the variables in :root to update all steps at once.
============================================================================= */

@layer components {
  .step-icon {
    width: var(--step-icon-size);
    height: var(--step-icon-size);
    border-radius: var(--step-icon-radius);
  }

  .step-icon > div {
    width: var(--step-icon-inner-size);
    height: var(--step-icon-inner-size);
  }

  .step-title {
    font-size: var(--step-title-size);
  }

  .step-description {
    max-width: var(--step-description-max-width);
  }

  .step-actions {
    margin-top: var(--step-actions-margin);
    gap: var(--step-actions-gap);
  }

  .feature-bullet {
    background-color: var(--foreground);
  }
}

/* =============================================================================
   KEYBOARD NAVIGATION FOCUS STYLES

   Consistent focus indicators for keyboard navigation across all focusable
   components: session list items, sidebar buttons, agent tree items, etc.

   Uses inset ring to avoid layout shifts and keep focus within bounds.
============================================================================= */

/* Session list items, nav buttons, tree items - consistent focus ring */
[role="listbox"] button:focus-visible,
[role="tree"] button:focus-visible,
[role="treeitem"]:focus-visible,
[role="option"]:focus-visible,
[data-focus-zone] button:focus-visible {
  outline: none;
  box-shadow: inset 0 0 0 1px var(--ring);
}

/* Ensure focus is visible even on selected/highlighted items */
[role="option"][aria-selected="true"]:focus-visible,
[role="treeitem"][aria-selected="true"]:focus-visible {
  box-shadow: inset 0 0 0 1px var(--ring);
}

/* Focus zone containers - subtle indicator when zone has focus */
[data-focus-zone]:focus-visible {
  outline: none;
}

/* =============================================================================
   SESSION LIST - SEPARATOR VISIBILITY

   Hide separators when session items are hovered or selected.
   Uses :has() to target adjacent sibling separators.
============================================================================= */

/* Hide own separator when item is hovered or selected */
.session-item:hover > .session-separator,
.session-item[data-selected] > .session-separator {
  opacity: 0;
}

/* Hide next item's separator when current item is hovered or selected */
.session-item:hover + .session-item > .session-separator,
.session-item[data-selected] + .session-item > .session-separator {
  opacity: 0;
}

/* =============================================================================
   SOURCES LIST - SEPARATOR VISIBILITY

   Hide separators when source items are hovered or selected.
   Same logic as session list.
============================================================================= */

/* Hide own separator when item is hovered or selected */
.source-item:hover > .source-separator,
.source-item[data-selected] > .source-separator {
  opacity: 0;
}

/* Hide next item's separator when current item is hovered or selected */
.source-item:hover + .source-item > .source-separator,
.source-item[data-selected] + .source-item > .source-separator {
  opacity: 0;
}

/* =============================================================================
   IMPORT LIST - SEPARATOR VISIBILITY

   Hide separators when import items are hovered or selected.
   Same logic as session list.
============================================================================= */

/* Hide own separator when item is hovered or selected */
.import-item:hover > .import-separator,
.import-item[data-selected] > .import-separator {
  opacity: 0;
}

/* Hide next item's separator when current item is hovered or selected */
.import-item:hover + .import-item > .import-separator,
.import-item[data-selected] + .import-item > .import-separator {
  opacity: 0;
}

/* =============================================================================
   LOADING INDICATOR - SPINKIT GRID SPINNER

   3x3 grid spinner based on SpinKit Grid.
   - Uses currentColor (inherits text color)
   - Uses em units (scales with font-size)
   - Pure CSS animation with staggered delays

   https://github.com/tobiasahlin/SpinKit
============================================================================= */

.spinner {
  display: inline-grid;
  grid-template-columns: repeat(3, 1fr);
  width: 1em;
  height: 1em;
  gap: 0.08em;
}

.spinner-cube {
  background-color: currentColor;
  animation: spinner-grid 1.3s infinite ease-in-out;
  transform: scale3d(0.5, 0.5, 1);
}

.spinner-cube:nth-child(1) { animation-delay: 0.2s; }
.spinner-cube:nth-child(2) { animation-delay: 0.3s; }
.spinner-cube:nth-child(3) { animation-delay: 0.4s; }
.spinner-cube:nth-child(4) { animation-delay: 0.1s; }
.spinner-cube:nth-child(5) { animation-delay: 0.2s; }
.spinner-cube:nth-child(6) { animation-delay: 0.3s; }
.spinner-cube:nth-child(7) { animation-delay: 0s; }
.spinner-cube:nth-child(8) { animation-delay: 0.1s; }
.spinner-cube:nth-child(9) { animation-delay: 0.2s; }

@keyframes spinner-grid {
  0%, 70%, 100% {
    transform: scale3d(0.5, 0.5, 1);
  }
  35% {
    transform: scale3d(0, 0, 1);
  }
}

/* Toast animation - scale and fade in */
@keyframes toast-in {
  from {
    opacity: 0;
    transform: scale(0.75);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* =============================================================================
   SHIMMER ANIMATION FOR OPTIMISTIC UI

   Subtle shimmer effect for messages awaiting backend confirmation.
   Uses a gradient sweep to indicate pending state without being distracting.
============================================================================= */

@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.animate-shimmer {
  position: relative;
  overflow: hidden;
}

.animate-shimmer::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 0%,
    oklch(from var(--foreground) l c h / 0.06) 50%,
    transparent 100%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s ease-in-out infinite;
  pointer-events: none;
  border-radius: inherit;
}

/* Text shimmer - subtle opacity pulse for inline text (title regeneration, etc.) */
.animate-shimmer-text {
  animation: shimmer-text 1.2s ease-in-out infinite;
}

@keyframes shimmer-text {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

/* =============================================================================
   SHAKE ANIMATION

   Horizontal shake for invalid actions (e.g., trying to disable last mode).
============================================================================= */

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
  20%, 40%, 60%, 80% { transform: translateX(2px); }
}

.animate-shake {
  animation: shake 0.4s ease-in-out;
}

/* =============================================================================
   SONNER TOAST OVERRIDES

   Override sonner's inline box-shadow with our design system shadow.
============================================================================= */

[data-sonner-toast] {
  box-shadow: var(--shadow-modal-small) !important;
  background-color: oklch(from var(--popover) l c h / 0.8) !important;
  -webkit-app-region: no-drag !important;
  /* Fixed width to ensure text truncation works */
  width: 356px !important;
}

/* Hide icon container to remove leftover padding */
[data-sonner-toast] [data-icon] {
  display: none !important;
}

/* Single line titles and descriptions with ellipsis overflow */
[data-sonner-toast] [data-title],
[data-sonner-toast] [data-description] {
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
  /* Required for text truncation in flex containers */
  min-width: 0 !important;
}

/* Ensure content area doesn't overflow toast bounds */
[data-sonner-toast] [data-content] {
  min-width: 0 !important;
  overflow: hidden !important;
}

/* Description (subtitle) at 70% opacity */
[data-sonner-toast] [data-description] {
  opacity: 0.7 !important;
}

[data-sonner-toast] [data-button],
[data-sonner-toast] [data-cancel] {
  background-color: var(--background) !important;
  box-shadow: var(--shadow-minimal) !important;
  color: oklch(from var(--foreground) l c h / 0.7) !important;
  transition: color 0.15s ease !important;
}

[data-sonner-toast] [data-button]:hover,
[data-sonner-toast] [data-cancel]:hover {
  color: var(--foreground) !important;
}

/* Close button styling - move to top right, show only on hover */
[data-sonner-toast] [data-close-button] {
  left: unset !important;
  right: -14px !important;
  opacity: 0 !important;
  transition: opacity 0.15s ease !important;
  background-color: var(--background) !important;
  border: none !important;
  box-shadow:
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(0, 0, 0, 0) 0px 0px 0px 0px,
    rgba(var(--foreground-rgb), 0.06) 0px 0px 0px 1px,
    rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 1px 1px -0.5px,
    rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 3px 3px -1.5px,
    rgba(0, 0, 0, var(--shadow-blur-opacity)) 0px 6px 6px -3px !important;
}

[data-sonner-toast].group:hover [data-close-button],
[data-sonner-toast]:hover [data-close-button] {
  opacity: 1 !important;
}

/* Tinted backgrounds for toast states - use linear-gradient to layer
   the tint color on top of the base popover background in one property.
   Title and description get subtle color tinting via [data-title] and [data-description]. */
[data-sonner-toast][data-type="error"] {
  background: linear-gradient(rgba(var(--destructive-rgb), 0.07), rgba(var(--destructive-rgb), 0.07)),
    oklch(from var(--popover) l c h / 0.8) !important;
}

[data-sonner-toast][data-type="error"] [data-title],
[data-sonner-toast][data-type="error"] [data-description] {
  color: color-mix(in srgb, rgb(var(--foreground-rgb)) 70%, rgb(var(--destructive-rgb))) !important;
}

[data-sonner-toast][data-type="warning"] {
  background: linear-gradient(rgba(var(--info-rgb), 0.07), rgba(var(--info-rgb), 0.07)),
    oklch(from var(--popover) l c h / 0.8) !important;
}

[data-sonner-toast][data-type="warning"] [data-title],
[data-sonner-toast][data-type="warning"] [data-description] {
  color: color-mix(in srgb, rgb(var(--foreground-rgb)) 70%, rgb(var(--info-rgb))) !important;
}

[data-sonner-toast][data-type="success"] {
  background: linear-gradient(rgba(var(--success-rgb), 0.07), rgba(var(--success-rgb), 0.07)),
    oklch(from var(--popover) l c h / 0.8) !important;
}

[data-sonner-toast][data-type="success"] [data-title],
[data-sonner-toast][data-type="success"] [data-description] {
  color: color-mix(in srgb, rgb(var(--foreground-rgb)) 70%, rgb(var(--success-rgb))) !important;
}

/* Dark mode: stronger tints since dark backgrounds absorb color more */
.dark [data-sonner-toast][data-type="error"] {
  background: linear-gradient(rgba(var(--destructive-rgb), 0.15), rgba(var(--destructive-rgb), 0.15)),
    oklch(from var(--popover) l c h / 0.8) !important;
}

.dark [data-sonner-toast][data-type="warning"] {
  background: linear-gradient(rgba(var(--info-rgb), 0.15), rgba(var(--info-rgb), 0.15)),
    oklch(from var(--popover) l c h / 0.8) !important;
}

.dark [data-sonner-toast][data-type="success"] {
  background: linear-gradient(rgba(var(--success-rgb), 0.15), rgba(var(--success-rgb), 0.15)),
    oklch(from var(--popover) l c h / 0.8) !important;
}
